AnalysisType: rule
Description: "Identifies disabling of default EBS encryption. Disabling default encryption does not change the encryption status of existing volumes. "
DisplayName: "AWS EC2 EBS Encryption Disabled"
Enabled: true
Filename: aws_ec2_ebs_encryption_disabled.py
Reports:
  MITRE ATT&CK:
    - TA0040:T1486
    - TA0040:T1565
Runbook: Verify this action was intended and if any EBS volumes were created after the change.
Reference: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default
Severity: Medium
Tests:
  - ExpectedResult: true
    Name: DisableEbsEncryptionByDefault Event
    Log:
      {
        "awsRegion": "us-east-1",
        "eventName": "DisableEbsEncryptionByDefault",
        "eventSource": "ec2.amazonaws.com",
        "recipientAccountId": "123456789",
        "sourceIPAddress": "1.2.3.4",
        "userAgent": "Chrome Browser",
        "p_log_type": "AWS.CloudTrail",
      }
  - ExpectedResult: false
    Name: Non Matching Event
    Log:
      {
        "awsRegion": "ap-northeast-1",
        "eventName": "DescribeInstanceStatus",
        "eventSource": "ec2.amazonaws.com",
        "eventTime": "2022-09-25 16:16:37",
        "eventType": "AwsApiCall",
        "readOnly": true,
        "sourceIPAddress": "1.2.3.4",
        "userAgent": "Datadog",
        "p_log_type": "AWS.CloudTrail",
      }
  - ExpectedResult: true
    Name: DisableEbsEncryptionByDefault Event - OCSF
    Log:
      {
        "api":
          {
            "operation": "DisableEbsEncryptionByDefault",
            "service": { "name": "ec2.amazonaws.com" },
          },
        "cloud": { "provider": "AWS", "region": "us-east-2" },
        "src_endpoint": { "ip": "111.111.111.111" },
        "unmapped": { "recipientAccountId": "123456789012" },
        "p_log_type": "OCSF.ApiActivity",
      }
  - ExpectedResult: false
    Name: Non Matching Event - OCSF
    Log:
      {
        "api":
          {
            "operation": "DescribeInstanceStatus",
            "service": { "name": "ec2.amazonaws.com" },
          },
        "cloud": { "provider": "AWS", "region": "ap-northeast-1" },
        "src_endpoint": { "ip": "111.111.111.111" },
        "unmapped": { "recipientAccountId": "123456789012" },
        "p_log_type": "OCSF.ApiActivity",
      }
DedupPeriodMinutes: 60
LogTypes:
  - AWS.CloudTrail
  - OCSF.ApiActivity
Tags:
  - DataModel
RuleID: "AWS.EC2.EBS.Encryption.Disabled"
Threshold: 1
